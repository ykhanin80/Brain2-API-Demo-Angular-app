<div class="actions-wrapper">
  <h2>Actions - Jobs</h2>

  <section class="job-form">
    <h3>[POST] Start Action</h3>
    <div class="field-row">
      <label>Action Name</label>
      <input [(ngModel)]="newJob.jobType" placeholder="e.g. ExportOrders" />
    </div>

    <div class="parameters">
      <h4>Parameters (optional)</h4>
      <div class="param-add">
        <input [(ngModel)]="parameterKey" placeholder="key" />
        <input [(ngModel)]="parameterValue" placeholder="value" />
        <button type="button" (click)="addParameter()" [disabled]="!parameterKey.trim()">Add</button>
      </div>
      <div class="param-list" *ngIf="newJob.parameters && (getObjectKeys(newJob.parameters).length > 0)">
        <div class="param-item" *ngFor="let key of getObjectKeys(newJob.parameters)">
          <span class="k">{{key}}</span>=<span class="v">{{newJob.parameters[key]}}</span>
          <button type="button" (click)="removeParameter(key)">x</button>
        </div>
      </div>
    </div>

    <div class="form-actions">
      <button type="button" (click)="submitJob()" [disabled]="isSubmitting">Start Action</button>
      <button type="button" (click)="resetForm()" [disabled]="isSubmitting">Reset</button>
      
      <!-- Progress Bar -->
      <div class="progress-container" *ngIf="jobProgress !== null">
        <div class="progress-info">
          <span class="progress-label">Job Progress</span>
          <span class="progress-percentage">{{jobProgress}}%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="jobProgress"></div>
        </div>
        <div class="progress-status" *ngIf="jobStatus">
             <span class="job-state" [class]="jobStatus.state?.toLowerCase()">{{jobStatus.state || 'Unknown'}}</span>
        </div>
      </div>
    </div>

    <div class="status-messages">
      <div class="success" *ngIf="successMessage">{{successMessage}}</div>
      <div class="error" *ngIf="errorMessage">{{errorMessage}}</div>
    </div>
    
    <!-- POST Response Window -->
    <div *ngIf="postResponse" class="api-response-window">
      <h4>POST Response:</h4>
      <div class="response-details">
        <div class="response-meta">
          <span class="method">POST</span>
          <span class="url">{{postUrl}}</span>
          <span class="status" [class.success]="!postResponse.isError" [class.error]="postResponse.isError">
            {{postResponse.isError ? 'ERROR' : 'SUCCESS'}}
          </span>
        </div>
        <pre class="response-body">{{postResponse.response | json}}</pre>
      </div>
    </div>
  </section>

  <!-- Combined Response Window -->
  <section class="response-section" *ngIf="postResponse || getResponse">
    <h3>API Response</h3>
    
    <!-- POST Response -->
    <div *ngIf="postResponse" class="api-response-window">
      <h4>POST Response:</h4>
      <div class="response-details">
        <div class="response-meta">
          <span class="method">POST</span>
          <span class="url">{{postUrl}}</span>
          <span class="status" [class.success]="!postResponse.isError" [class.error]="postResponse.isError">
            {{postResponse.isError ? 'ERROR' : 'SUCCESS'}}
          </span>
        </div>
        <pre class="response-body">{{postResponse.response | json}}</pre>
      </div>
    </div>

    <!-- Auto Job Status Check -->
    <div *ngIf="isCheckingStatus" class="status-checking">
      <h4>Checking Job Status...</h4>
      <div class="loading">Getting job status automatically...</div>
    </div>

    <!-- GET Response -->
    <div *ngIf="getResponse" class="api-response-window">
      <h4>GET Response (Job Status):</h4>
      <div class="response-details">
        <div class="response-meta">
          <span class="method">GET</span>
          <span class="url">{{getUrl}}</span>
          <span class="status" [class.success]="!getResponse.isError" [class.error]="getResponse.isError">
            {{getResponse.isError ? 'ERROR' : 'SUCCESS'}}
          </span>
        </div>
        <pre class="response-body">{{getResponse.response | json}}</pre>
      </div>
    </div>
  </section>
</div>
